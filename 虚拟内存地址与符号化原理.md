# è™šæ‹Ÿå†…å­˜åœ°å€ä¸ç¬¦å·åŒ–åŸç†

## ğŸ“‹ æ ¸å¿ƒé—®é¢˜

**Q: `backtrace()` æ•è·çš„è™šæ‹Ÿå†…å­˜åœ°å€å¯ä»¥é€šè¿‡ç¬¦å·è¡¨è§£æå—ï¼Ÿ**

**A: å¯ä»¥ï¼** æœ‰ä¸¤ç§ç¬¦å·åŒ–æ–¹å¼ï¼š
1. **è¿è¡Œæ—¶ç¬¦å·åŒ–**ï¼šä½¿ç”¨ `dladdr()` æŸ¥è¯¢å·²åŠ è½½çš„ç¬¦å·è¡¨
2. **ç¦»çº¿ç¬¦å·åŒ–**ï¼šä½¿ç”¨ `atos` å·¥å…· + dSYM æ–‡ä»¶

---

## 1ï¸âƒ£ è™šæ‹Ÿå†…å­˜åœ°å€çš„æœ¬è´¨

### 1.1 ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜åœ°å€ï¼Ÿ

```c
// backtrace() è¿”å›çš„åœ°å€
uintptr_t addresses[] = {
    0x0000000102abc100,  // â† è™šæ‹Ÿå†…å­˜åœ°å€ï¼ˆVirtual Memory Addressï¼‰
    0x0000000102abd200,
    0x00000001febcd300,
    // ...
};
```

**è™šæ‹Ÿå†…å­˜åœ°å€ = ç›¸å¯¹åç§» + ASLR éšæœºåŸºå€**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–è¯‘æ—¶åœ°å€ï¼ˆå›ºå®šï¼‰                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0x100000000  â† Mach-O æ–‡ä»¶ä¸­çš„åŸºç¡€åœ°å€ï¼ˆå›ºå®šï¼‰     â”‚
â”‚  0x100001abc  â† å‡½æ•°åœ¨æ–‡ä»¶ä¸­çš„åç§»                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ è¿è¡Œæ—¶ + ASLR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿è¡Œæ—¶åœ°å€ï¼ˆåŠ¨æ€ï¼‰                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0x102000000  â† ASLR éšæœºæ»‘åŠ¨åçš„åŸºå€               â”‚
â”‚  0x102001abc  â† å®é™…è¿è¡Œæ—¶åœ°å€ï¼ˆbacktrace è¿”å›ï¼‰    â”‚
â”‚                   = 0x102000000 + 0x1abc           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ASLRï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰

**ç›®çš„ï¼š** é˜²æ­¢å†…å­˜æ”»å‡»

```objc
// æ¯æ¬¡å¯åŠ¨åº”ç”¨ï¼Œåº“çš„åŠ è½½åœ°å€éƒ½ä¸åŒ
å¯åŠ¨ 1:  Foundation.framework  åŠ è½½åœ°å€: 0x1a3000000
å¯åŠ¨ 2:  Foundation.framework  åŠ è½½åœ°å€: 0x1c5000000  // âœ… éšæœºå˜åŒ–
å¯åŠ¨ 3:  Foundation.framework  åŠ è½½åœ°å€: 0x198000000
```

---

## 2ï¸âƒ£ ç¬¦å·åŒ–æ–¹å¼ä¸€ï¼šè¿è¡Œæ—¶ç¬¦å·åŒ– (dladdr)

### 2.1 åŸç†

**è¿è¡Œæ—¶åŠ¨æ€åº“ä¿¡æ¯åœ¨å†…å­˜ä¸­å¯æŸ¥è¯¢ï¼**

```c
#include <dlfcn.h>

uintptr_t address = 0x102abc100;  // backtrace è¿”å›çš„åœ°å€

Dl_info info;
if (dladdr((void *)address, &info)) {
    printf("åº“åç§°:   %s\n", info.dli_fname);    // /path/to/MatrixTestApp
    printf("åº“åŸºå€:   %p\n", info.dli_fbase);    // 0x102000000
    printf("ç¬¦å·åç§°: %s\n", info.dli_sname);    // -[ViewController testScenario2]
    printf("ç¬¦å·åœ°å€: %p\n", info.dli_saddr);    // 0x102abc100
}
```

### 2.2 Dl_info ç»“æ„ä½“

```c
typedef struct dl_info {
    const char *dli_fname;  // åº“æ–‡ä»¶è·¯å¾„ "/var/.../MatrixTestApp.app/MatrixTestApp"
    void       *dli_fbase;  // åº“åŠ è½½åŸºå€ (ASLR åçš„åœ°å€)
    const char *dli_sname;  // ç¬¦å·åç§°ï¼ˆå‡½æ•°å/æ–¹æ³•åï¼‰
    void       *dli_saddr;  // ç¬¦å·åœ°å€ï¼ˆå‡½æ•°å…¥å£åœ°å€ï¼‰
} Dl_info;
```

### 2.3 Matrix ä¸­çš„è¿è¡Œæ—¶ç¬¦å·åŒ–å®ç°

**æ–‡ä»¶ï¼š** `KSSymbolicator.c`

```c
bool kssymbolicator_symbolicate(KSStackCursor *cursor) {
    Dl_info symbolsBuffer;
    
    // æŸ¥è¯¢åœ°å€å¯¹åº”çš„ç¬¦å·ä¿¡æ¯
    if (ksdl_dladdr_use_cache(cursor->stackEntry.address, &symbolsBuffer)) {
        cursor->stackEntry.imageAddress = (uintptr_t)symbolsBuffer.dli_fbase;   // åº“åŸºå€
        cursor->stackEntry.imageName = symbolsBuffer.dli_fname;                 // åº“è·¯å¾„
        cursor->stackEntry.symbolAddress = (uintptr_t)symbolsBuffer.dli_saddr;  // ç¬¦å·åœ°å€
        cursor->stackEntry.symbolName = symbolsBuffer.dli_sname;                // âœ… ç¬¦å·åç§°
        return true;
    }
    
    return false;
}
```

**æ–‡ä»¶ï¼š** `WCMatrixModel.mm`

```objc
- (void)symbolicate {
    Dl_info symbolsBuffer;
    
    // å¯¹åœ°å€è¿›è¡Œç¬¦å·åŒ–
    if (ksdl_dladdr_use_cache(CALL_INSTRUCTION_FROM_RETURN_ADDRESS(self.address), &symbolsBuffer)) {
        m_symbolName = symbolsBuffer.dli_sname;  // âœ… è·å–å‡½æ•°å
    }
    
    // é€’å½’ç¬¦å·åŒ–å­å¸§
    for (WCAddressFrame *addressFrame in _childAddressFrame) {
        [addressFrame symbolicate];
    }
}
```

### 2.4 è¿è¡Œæ—¶ç¬¦å·åŒ–çš„ä¼˜ç¼ºç‚¹

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| âœ… å¿«é€Ÿï¼ˆæŸ¥è¯¢å†…å­˜å³å¯ï¼‰ | âŒ æ— æ³•è·å–æºæ–‡ä»¶è·¯å¾„å’Œè¡Œå· |
| âœ… ä¸éœ€è¦å¤–éƒ¨æ–‡ä»¶ | âŒ ç¬¦å·å¯èƒ½è¢« strip ç§»é™¤ï¼ˆRelease æ„å»ºï¼‰ |
| âœ… é€‚åˆå®æ—¶ç›‘æ§ | âŒ C++ ç¬¦å·æ˜¯ mangled åç§°ï¼ˆéš¾è¯»ï¼‰ |

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
è¿è¡Œæ—¶ç¬¦å·åŒ–ç»“æœ:
âœ… -[TestAsyncCPUViewController testScenario2]  (Objective-C æ–¹æ³•å)
âœ… _ZN6MyTest15heavyComputationEv  (C++ mangled åç§°)
âŒ æ— æ³•è·å–: TestAsyncCPUViewController.mm:123  (éœ€è¦ dSYM)
```

---

## 3ï¸âƒ£ ç¬¦å·åŒ–æ–¹å¼äºŒï¼šç¦»çº¿ç¬¦å·åŒ– (atos + dSYM)

### 3.1 åŸç†

**ä½¿ç”¨ dSYM æ–‡ä»¶è¿›è¡Œå®Œæ•´ç¬¦å·åŒ–**

```
Xcode ç¼–è¯‘æ—¶ç”Ÿæˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MatrixTestApp.app           â”‚  â† å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆç¬¦å·å¯èƒ½è¢« stripï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MatrixTestApp.app.dSYM      â”‚  â† è°ƒè¯•ç¬¦å·æ–‡ä»¶ï¼ˆå®Œæ•´ç¬¦å·è¡¨ï¼‰
â”‚  â”œâ”€â”€ DWARF/MatrixTestApp    â”‚     åŒ…å«ï¼šå‡½æ•°åã€æºæ–‡ä»¶è·¯å¾„ã€è¡Œå·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 atos å·¥å…·ä½¿ç”¨

```bash
# ç¬¦å·åŒ–å•ä¸ªåœ°å€
atos -arch arm64 \
     -o MatrixTestApp.app/MatrixTestApp \
     -l 0x102000000 \  # åº“åŠ è½½åœ°å€ï¼ˆASLR åŸºå€ï¼‰
     0x102abc100       # è¦ç¬¦å·åŒ–çš„åœ°å€

# è¾“å‡ºï¼š
-[TestAsyncCPUViewController testScenario2] (in MatrixTestApp) (TestAsyncCPUViewController.mm:45)
```

**å‚æ•°è¯´æ˜ï¼š**
- `-arch arm64`: CPU æ¶æ„ï¼ˆarm64/x86_64ï¼‰
- `-o`: dSYM æˆ–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
- `-l`: åº“åŠ è½½åœ°å€ï¼ˆLoad Addressï¼Œä» binary_images ä¸­è·å–ï¼‰
- æœ€åæ˜¯è¦ç¬¦å·åŒ–çš„è™šæ‹Ÿå†…å­˜åœ°å€

### 3.3 è®¡ç®—åŠ è½½åœ°å€å’Œåç§»

```
è™šæ‹Ÿå†…å­˜åœ°å€ = åŠ è½½åœ°å€ + åç§»

0x102abc100 = 0x102000000 + 0x00abc100
    â†‘            â†‘              â†‘
 è¿è¡Œæ—¶åœ°å€   ASLR åŸºå€     å›ºå®šåç§»ï¼ˆåœ¨ Mach-O ä¸­ï¼‰
```

**å¦‚ä½•è·å–åŠ è½½åœ°å€ï¼Ÿ**

```objc
// æ–¹æ³• 1: éå†åŠ è½½çš„é•œåƒ
for (uint32_t i = 0; i < _dyld_image_count(); i++) {
    const struct mach_header *header = _dyld_get_image_header(i);
    intptr_t slide = _dyld_get_image_vmaddr_slide(i);
    const char *name = _dyld_get_image_name(i);
    
    printf("åº“: %s, åŠ è½½åœ°å€: %p, æ»‘åŠ¨: 0x%lx\n", name, header, slide);
}

// è¾“å‡ºï¼š
// åº“: /var/.../MatrixTestApp, åŠ è½½åœ°å€: 0x102000000, æ»‘åŠ¨: 0x2000000
```

**æ–¹æ³• 2: ä» Matrix æŠ¥å‘Šçš„ binary_images ä¸­è·å–**

```json
{
  "binary_images": [
    {
      "name": "/var/containers/.../MatrixTestApp.app/MatrixTestApp",
      "image_addr": 4328521728,  // â† è½¬åå…­è¿›åˆ¶ = 0x102000000
      "image_size": 16777216,
      "uuid": "12345678-1234-1234-1234-123456789ABC"
    }
  ]
}
```

### 3.4 Matrix ä¸­çš„ç¦»çº¿ç¬¦å·åŒ–å®ç°

**Python è„šæœ¬ï¼š** `symbolicate_matrix_report.py`

```python
def symbolicate_address(binary_path, load_addr, target_addr, arch='arm64'):
    """ä½¿ç”¨ atos ç¬¦å·åŒ–å•ä¸ªåœ°å€"""
    cmd = [
        'atos',
        '-arch', arch,
        '-o', binary_path,                  # dSYM è·¯å¾„
        '-l', hex(load_addr),               # åŠ è½½åœ°å€
        hex(target_addr)                    # è™šæ‹Ÿå†…å­˜åœ°å€
    ]
    
    result = subprocess.run(cmd, capture_output=True, text=True, timeout=5)
    
    if result.returncode == 0:
        symbol = result.stdout.strip()
        # è¿”å›ç±»ä¼¼ï¼š
        # -[TestAsyncCPUViewController testScenario2] (in MatrixTestApp) (TestAsyncCPUViewController.mm:45)
        if symbol and symbol != hex(target_addr):
            return symbol
    
    return None
```

**Go æœåŠ¡ï¼š** `matrix-symbolicate-server/symbolicate.go`

```go
func symbolicateAddress(binaryPath string, loadAddr uint64, targetAddr uint64, arch string) string {
    cmd := exec.Command(
        "atos",
        "-arch", arch,
        "-o", binaryPath,
        "-l", fmt.Sprintf("0x%x", loadAddr),
        fmt.Sprintf("0x%x", targetAddr),
    )
    
    var out bytes.Buffer
    cmd.Stdout = &out
    
    if err := cmd.Run(); err != nil {
        return ""
    }
    
    symbol := strings.TrimSpace(out.String())
    
    // æ£€æŸ¥æ˜¯å¦æˆåŠŸç¬¦å·åŒ–
    if symbol == "" || strings.HasPrefix(symbol, "0x") {
        return ""
    }
    
    return symbol
}
```

### 3.5 ç¦»çº¿ç¬¦å·åŒ–çš„ä¼˜ç¼ºç‚¹

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| âœ… æä¾›å®Œæ•´ä¿¡æ¯ï¼ˆæ–‡ä»¶å + è¡Œå·ï¼‰ | âŒ éœ€è¦ dSYM æ–‡ä»¶ |
| âœ… æ”¯æŒ strip åçš„äºŒè¿›åˆ¶ | âŒ éœ€è¦å¤–éƒ¨å·¥å…·ï¼ˆatosï¼‰ |
| âœ… ç¬¦å·åå®Œæ•´å¯è¯» | âŒ ä¸é€‚åˆå®æ—¶ç¬¦å·åŒ– |
| âœ… æ”¯æŒ C++ demangling | âŒ å¿…é¡»åŒ¹é…æ­£ç¡®çš„ dSYM ç‰ˆæœ¬ï¼ˆUUIDï¼‰ |

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ç¦»çº¿ç¬¦å·åŒ–ç»“æœ:
âœ… -[TestAsyncCPUViewController testScenario2] (in MatrixTestApp) (TestAsyncCPUViewController.mm:45)
âœ… MyTest::heavyComputation() (in MatrixTestApp) (MyTest.cpp:123)  // C++ å·² demangle
```

---

## 4ï¸âƒ£ å®Œæ•´çš„ç¬¦å·åŒ–æµç¨‹

```mermaid
graph TB
    A[backtrace è·å–è™šæ‹Ÿåœ°å€<br/>0x102abc100] --> B{é€‰æ‹©ç¬¦å·åŒ–æ–¹å¼}
    
    B -->|è¿è¡Œæ—¶| C[dladdr æŸ¥è¯¢]
    C --> D[æŸ¥è¯¢åŠ¨æ€é“¾æ¥å™¨<br/>_dyld_get_image_header]
    D --> E[è¿”å› Dl_info<br/>å‡½æ•°å: testScenario2]
    
    B -->|ç¦»çº¿| F[å‡†å¤‡ dSYM æ–‡ä»¶]
    F --> G[è·å–åŠ è½½åœ°å€<br/>0x102000000]
    G --> H[è°ƒç”¨ atos å·¥å…·]
    H --> I[è¿”å›å®Œæ•´ä¿¡æ¯<br/>testScenario2<br/>TestAsyncCPUViewController.mm:45]
    
    E --> J[ç¬¦å·åŒ–å®Œæˆ]
    I --> J
```

---

## 5ï¸âƒ£ Matrix ä¸­çš„å®é™…åº”ç”¨

### 5.1 å®æ—¶ç›‘æ§ï¼ˆè¿è¡Œæ—¶ç¬¦å·åŒ–ï¼‰

```objc
// WCPowerConsumeStackCollector.mm
// CPU é‡‡æ ·æ—¶å®æ—¶ç¬¦å·åŒ–
- (void)makeConclusion {
    // 1. è·å–è™šæ‹Ÿåœ°å€
    uintptr_t addresses[100];
    int count = kssc_backtraceCurrentThread(thread, addresses, 100);
    
    // 2. è¿è¡Œæ—¶ç¬¦å·åŒ–
    for (int i = 0; i < count; i++) {
        Dl_info info;
        if (dladdr((void *)addresses[i], &info)) {
            NSLog(@"åœ°å€: 0x%lx -> å‡½æ•°: %s", addresses[i], info.dli_sname);
        }
    }
}
```

### 5.2 æŠ¥å‘Šåˆ†æï¼ˆç¦»çº¿ç¬¦å·åŒ–ï¼‰

```bash
# ä½¿ç”¨ Python è„šæœ¬ç¬¦å·åŒ–æŠ¥å‘Š
python symbolicate_matrix_report.py \
    --report report.json \
    --dsym MatrixTestApp.app.dSYM \
    --output symbolicated_report.json

# è¾“å‡ºï¼š
# âœ… ç¬¦å·åŒ–æˆåŠŸ: 125 ä¸ªåœ°å€
# âœ… åº”ç”¨ä»£ç : 45 å¸§
# âœ… ç³»ç»Ÿåº“: 80 å¸§
```

### 5.3 å¼‚æ­¥å †æ ˆè¿½æº¯ä¸­çš„ç¬¦å·åŒ–

```objc
// WCAsyncStackTraceManager.mm
// 1. æ•è·è™šæ‹Ÿåœ°å€
uintptr_t stackBuffer[50];
int count = backtrace((void **)buffer, 50);

// 2. ä¿å­˜åœ°å€ä¾›åç»­ç¬¦å·åŒ–
NSArray *originStack = stackToArray(stackBuffer, count);

// 3. åç»­å¯ä»¥ç”¨ dladdr æˆ– atos ç¬¦å·åŒ–
for (NSNumber *addr in originStack) {
    Dl_info info;
    if (dladdr((void *)[addr unsignedLongValue], &info)) {
        printf("å¼‚æ­¥å‘èµ·è€…: %s\n", info.dli_sname);
    }
}
```

---

## 6ï¸âƒ£ å¸¸è§é—®é¢˜

### Q1: Release æ„å»ºä¼šä¸ä¼šæ— æ³•ç¬¦å·åŒ–ï¼Ÿ

**A:** åˆ†æƒ…å†µï¼š
- **è¿è¡Œæ—¶ç¬¦å·åŒ– (`dladdr`)**: 
  - âŒ å¦‚æœå¼€å¯äº† `Strip Debug Symbols`ï¼Œè¿è¡Œæ—¶ç¬¦å·åŒ–ä¼šå¤±è´¥
  - âœ… ä¿ç•™ç¬¦å·ï¼ˆè®¾ç½® `Strip Style = Non-Global Symbols`ï¼‰å¯éƒ¨åˆ†ç¬¦å·åŒ–
  
- **ç¦»çº¿ç¬¦å·åŒ– (`atos` + dSYM)**:
  - âœ… å³ä½¿äºŒè¿›åˆ¶è¢«å®Œå…¨ stripï¼Œåªè¦æœ‰åŒ¹é…çš„ dSYM æ–‡ä»¶å°±èƒ½å®Œæ•´ç¬¦å·åŒ–

### Q2: å¦‚ä½•éªŒè¯ dSYM å’ŒäºŒè¿›åˆ¶æ˜¯å¦åŒ¹é…ï¼Ÿ

```bash
# æŸ¥çœ‹äºŒè¿›åˆ¶çš„ UUID
dwarfdump --uuid MatrixTestApp.app/MatrixTestApp
# UUID: 12345678-1234-1234-1234-123456789ABC (arm64) MatrixTestApp

# æŸ¥çœ‹ dSYM çš„ UUID
dwarfdump --uuid MatrixTestApp.app.dSYM
# UUID: 12345678-1234-1234-1234-123456789ABC (arm64) MatrixTestApp

# âœ… UUID å¿…é¡»å®Œå…¨ä¸€è‡´ï¼
```

### Q3: C++ ç¬¦å·ä¸ºä»€ä¹ˆæ˜¯ä¹±ç ï¼Ÿ

```
è¿è¡Œæ—¶ç¬¦å·åŒ–:
âŒ _ZN6MyTest15heavyComputationEv  (mangled)

ç¦»çº¿ç¬¦å·åŒ–:
âœ… MyTest::heavyComputation()  (demangled)
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ‰‹åŠ¨ demangle
c++filt _ZN6MyTest15heavyComputationEv
# è¾“å‡º: MyTest::heavyComputation()
```

### Q4: æ€§èƒ½å¼€é”€å¦‚ä½•ï¼Ÿ

| æ“ä½œ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| `backtrace()` è·å–åœ°å€ | ~0.1ms | å¿«é€Ÿ |
| `dladdr()` è¿è¡Œæ—¶ç¬¦å·åŒ– | ~0.05ms | æŸ¥è¯¢å†…å­˜ |
| `atos` ç¦»çº¿ç¬¦å·åŒ– | ~50-100ms | å¯åŠ¨è¿›ç¨‹ + è§£æ dSYM |

**å»ºè®®ï¼š**
- âœ… å®æ—¶ç›‘æ§ï¼šä½¿ç”¨ `backtrace()` + `dladdr()`
- âœ… æŠ¥å‘Šåˆ†æï¼šä½¿ç”¨ `atos` + dSYMï¼ˆæ‰¹é‡ç¬¦å·åŒ–ï¼‰

---

## 7ï¸âƒ£ æ€»ç»“

### æ ¸å¿ƒç­”æ¡ˆ

**âœ… `backtrace()` æ•è·çš„è™šæ‹Ÿå†…å­˜åœ°å€å¯ä»¥é€šè¿‡ç¬¦å·è¡¨è§£æï¼**

| æ–¹å¼ | æŠ€æœ¯ | é€‚ç”¨åœºæ™¯ | ä¿¡æ¯å®Œæ•´åº¦ |
|------|------|----------|-----------|
| **è¿è¡Œæ—¶** | `dladdr()` | å®æ—¶ç›‘æ§ã€å¿«é€Ÿè¯Šæ–­ | â­â­â­ å‡½æ•°å |
| **ç¦»çº¿** | `atos` + dSYM | æŠ¥å‘Šåˆ†æã€è¯¦ç»†å®šä½ | â­â­â­â­â­ å‡½æ•°å + æ–‡ä»¶ + è¡Œå· |

### å…³é”®æŠ€æœ¯ç‚¹

```
è™šæ‹Ÿå†…å­˜åœ°å€ (backtrace è¿”å›)
    â†“
ASLR åŸºå€ + å›ºå®šåç§»
    â†“
æŸ¥è¯¢ç¬¦å·è¡¨ï¼ˆè¿è¡Œæ—¶æˆ– dSYMï¼‰
    â†“
å‡½æ•°å + æºæ–‡ä»¶ + è¡Œå·
```

### Matrix å®ç°æ€»ç»“

1. **é‡‡é›†é˜¶æ®µ**: `backtrace()` è·å–è™šæ‹Ÿåœ°å€
2. **å®æ—¶é˜¶æ®µ**: `dladdr()` å¿«é€Ÿç¬¦å·åŒ–ï¼ˆç”¨äºæ—¥å¿—ï¼‰
3. **åˆ†æé˜¶æ®µ**: `atos` + dSYM å®Œæ•´ç¬¦å·åŒ–ï¼ˆç”¨äºæŠ¥å‘Šï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2026-01-06  
**å…³é”®è¯ï¼š** è™šæ‹Ÿå†…å­˜åœ°å€ã€ç¬¦å·åŒ–ã€dladdrã€atosã€dSYMã€ASLR






